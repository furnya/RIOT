From 59ff5a12144de7b3b669c5e430e3f6022a6ad630 Mon Sep 17 00:00:00 2001
From: Martine Lenders <m.lenders@fu-berlin.de>
Date: Tue, 27 Feb 2018 15:37:55 +0100
Subject: [PATCH 2/4] ccnl-riot: Register CCN-lite stack only once to GNRC

---
 src/ccnl-riot/src/ccn-lite-riot.c | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/src/ccnl-riot/src/ccn-lite-riot.c b/src/ccnl-riot/src/ccn-lite-riot.c
index d26b8e6..2311bed 100644
--- a/src/ccnl-riot/src/ccn-lite-riot.c
+++ b/src/ccnl-riot/src/ccn-lite-riot.c
@@ -240,10 +240,13 @@ ccnl_open_netif(kernel_pid_t if_pid, gnrc_nettype_t netreg_type)
 
     /* configure the interface to use the specified nettype protocol */
     gnrc_netapi_set(if_pid, NETOPT_PROTO, 0, &netreg_type, sizeof(gnrc_nettype_t));
-    /* register for this nettype */
-    gnrc_netreg_entry_init_pid(&_ccnl_ne, GNRC_NETREG_DEMUX_CTX_ALL,
-                               _ccnl_event_loop_pid);
-    return gnrc_netreg_register(netreg_type, &_ccnl_ne);
+    /* register for this nettype if not already done */
+    if (_ccnl_ne.demux_ctx == 0) {
+        gnrc_netreg_entry_init_pid(&_ccnl_ne, GNRC_NETREG_DEMUX_CTX_ALL,
+                                   _ccnl_event_loop_pid);
+        return gnrc_netreg_register(netreg_type, &_ccnl_ne);
+    }
+    return 0;
 }
 
 static msg_t _ageing_reset = { .type = CCNL_MSG_AGEING };
-- 
2.7.4

